<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mini VS Code Editor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>

    <style>
        :root {
            --bg: #0f172a;
            --panel: #020617;
            --border: #1e293b;
            --accent: #38bdf8;
            --text: #e5e7eb;
        }

        * { box-sizing: border-box; }
        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: system-ui, -apple-system, sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        .header {
            height: 48px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 12px;
            background: var(--panel);
            border-bottom: 1px solid var(--border);
            z-index: 10;
        }

        button {
            background: #1e293b;
            border: 1px solid #334155;
            color: var(--text);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        button.active { background: #0ea5e9; border-color: #0ea5e9; }

        /* MOBILE TABS */
        .mobile-tabs {
            display: none;
            height: 44px;
            background: var(--panel);
            border-bottom: 1px solid var(--border);
        }
        .mobile-tabs div {
            flex: 1;
            text-align: center;
            line-height: 44px;
            cursor: pointer;
            font-weight: 500;
            color: #94a3b8;
        }
        .mobile-tabs .active {
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
        }

        /* MAIN AREA */
        .main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .editor-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* LEFT: CODE SIDE */
        .editor-left {
            width: 50%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            min-width: 0;
        }

        .tabs {
            display: flex;
            background: var(--panel);
            border-bottom: 1px solid var(--border);
        }
        .tab {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .tab.active {
            color: white;
            background: #1e293b;
            border-bottom: 2px solid var(--accent);
        }

        .editor-area { flex: 1; display: none; overflow: hidden; }
        .editor-area.active { display: block; }

        /* RIGHT: PREVIEW SIDE */
        .editor-right {
            flex: 1;
            background: #fff;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        iframe { width: 100%; height: 100%; border: none; background: #fff; }

        /* CONSOLE */
        .console {
            height: 160px;
            background: var(--panel);
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }
        .console-header {
            padding: 6px 12px;
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            background: rgba(255,255,255,0.02);
        }
        .console-body {
            flex: 1;
            overflow-y: auto;
            font-family: 'Cascadia Code', 'Fira Code', monospace;
            font-size: 12px;
            padding: 8px;
            color: #d1d5db;
        }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.03); padding-bottom: 2px; }
        .log-error { color: #f87171; }
        .log-warn { color: #fbbf24; }

        /* RESIZERS */
        .resize-v { width: 6px; cursor: col-resize; background: #020617; transition: background 0.2s; }
        .resize-h { height: 6px; cursor: row-resize; background: #020617; transition: background 0.2s; }
        .resize-v:hover, .resize-h:hover { background: var(--accent); }

        /* MOBILE FIXES */
        @media(max-width: 900px) {
            .mobile-tabs { display: flex; }
            .resize-v { display: none; }
            .editor-left, .editor-right { width: 100% !important; flex: none; }
            .editor-right.mobile-hide, .editor-left.mobile-hide { display: none; }
        }
    </style>
</head>
<body>

<div class="header">
    <button onclick="run()">Run â–¶</button>
    <button id="autoBtn" class="active" onclick="toggleAuto()">Auto Run: ON</button>
    <button onclick="exportZIP()">Export ZIP</button>
</div>

<div class="mobile-tabs">
    <div id="codeTab" class="active" onclick="showCode()">Code</div>
    <div id="previewTab" onclick="showPreview()">Preview</div>
</div>

<div class="main">
    <div class="editor-container" id="editorRoot">
        
        <div class="editor-left" id="codePane">
            <div class="tabs">
                <div class="tab active" onclick="switchEditor('html', event)">HTML</div>
                <div class="tab" onclick="switchEditor('css', event)">CSS</div>
                <div class="tab" onclick="switchEditor('js', event)">JS</div>
            </div>

            <div id="html" class="editor-area active"></div>
            <div id="css" class="editor-area"></div>
            <div id="js" class="editor-area"></div>

            <div class="resize-h" id="resizeConsole"></div>

            <div class="console" id="consoleBox">
                <div class="console-header">Output Console</div>
                <div class="console-body" id="console"></div>
            </div>
        </div>

        <div class="resize-v" id="resizeSplit"></div>

        <div class="editor-right mobile-hide" id="previewPane">
            <iframe id="preview"></iframe>
        </div>

    </div>
</div>

<script>
let editors = {}, autoRun = true;

/* INITIALIZE MONACO */
require.config({ paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs" }});
require(["vs/editor/editor.main"], function () {
    const commonConfig = {
        theme: "vs-dark",
        automaticLayout: true,
        fontSize: 14,
        minimap: { enabled: false },
        padding: { top: 10 }
    };

    editors.html = monaco.editor.create(document.getElementById("html"), {
        value: "<h1>Hello World</h1>\n<p>Try the mobile toggle!</p>",
        language: "html",
        ...commonConfig
    });

    editors.css = monaco.editor.create(document.getElementById("css"), {
        value: "body { font-family: sans-serif; padding: 20px; }\nh1 { color: #38bdf8; }",
        language: "css",
        ...commonConfig
    });

    editors.js = monaco.editor.create(document.getElementById("js"), {
        value: "console.log('Editor initialized!');\n\n// Click 'Run' or type to see updates",
        language: "javascript",
        ...commonConfig
    });

    // Handle Auto Run
    Object.values(editors).forEach(e => {
        e.onDidChangeModelContent(() => {
            if (autoRun) run();
        });
    });

    run(); // Initial run
});

/* RUN LOGIC */
function run() {
    const html = editors.html.getValue();
    const css = editors.css.getValue();
    const js = editors.js.getValue();

    const previewFrame = document.getElementById("preview");
    
    const source = `
        <!DOCTYPE html>
        <html>
        <head>
            <style>
                /* Default Styles for the Output */
                body { 
                    margin: 0; 
                    padding: 20px; 
                    font-family: sans-serif; 
                    color: #1a202c; /* Default dark text */
                    background-color: #ffffff; /* Default white background */
                }
                /* Your User CSS from the Editor tab */
                ${css}
            </style>
        </head>
        <body>
            ${html}
            <script>
                // ... (keep the console hook logic here) ...
                ${js}
            <\/script>
        </body>
        </html>
    `;
    previewFrame.srcdoc = source;
}
/* MESSAGE LISTENER FOR CONSOLE */
window.addEventListener("message", e => {
    if (!e.data.type) return;
    const consoleBody = document.getElementById("console");
    const div = document.createElement("div");
    div.className = `log-entry log-${e.data.type}`;
    div.textContent = `> ${e.data.msg}`;
    consoleBody.appendChild(div);
    consoleBody.scrollTop = consoleBody.scrollHeight;
});

/* UI: EDITOR SWITCHING */
function switchEditor(mode, event) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".editor-area").forEach(a => a.classList.remove("active"));
    
    event.target.classList.add("active");
    document.getElementById(mode).classList.add("active");
    
    // Fix Monaco layout when showing previously hidden div
    if (editors[mode]) editors[mode].layout();
}

/* UI: MOBILE TOGGLES */
function showPreview() {
    document.getElementById("codePane").classList.add("mobile-hide");
    document.getElementById("previewPane").classList.remove("mobile-hide");
    document.getElementById("previewTab").classList.add("active");
    document.getElementById("codeTab").classList.remove("active");
    run();
}

function showCode() {
    document.getElementById("previewPane").classList.add("mobile-hide");
    document.getElementById("codePane").classList.remove("mobile-hide");
    document.getElementById("codeTab").classList.add("active");
    document.getElementById("previewTab").classList.remove("active");
    
    // Ensure Monaco recalculates its width
    setTimeout(() => {
        Object.values(editors).forEach(e => e.layout());
    }, 10);
}

/* UI: AUTO RUN TOGGLE */
function toggleAuto() {
    autoRun = !autoRun;
    const btn = document.getElementById("autoBtn");
    btn.textContent = "Auto Run: " + (autoRun ? "ON" : "OFF");
    btn.classList.toggle("active", autoRun);
}

/* RESIZE: VERTICAL SPLIT */
(function() {
    const resizer = document.getElementById("resizeSplit");
    const left = document.getElementById("codePane");
    let isDragging = false;

    resizer.addEventListener("mousedown", () => isDragging = true);
    window.addEventListener("mouseup", () => isDragging = false);
    window.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        const rootRect = document.getElementById("editorRoot").getBoundingClientRect();
        let percentage = ((e.clientX - rootRect.left) / rootRect.width) * 100;
        
        if (percentage > 15 && percentage < 85) {
            left.style.width = percentage + "%";
        }
    });
})();

/* RESIZE: CONSOLE HEIGHT */
(function() {
    const resizer = document.getElementById("resizeConsole");
    const consoleBox = document.getElementById("consoleBox");
    let isDragging = false;

    resizer.addEventListener("mousedown", () => isDragging = true);
    window.addEventListener("mouseup", () => isDragging = false);
    window.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        const parent = consoleBox.parentElement;
        const rect = parent.getBoundingClientRect();
        let height = rect.bottom - e.clientY;
        
        if (height > 40 && height < rect.height - 100) {
            consoleBox.style.height = height + "px";
        }
    });
})();

/* ZIP EXPORT */
function exportZIP() {
    const zip = new JSZip();
    const html = `<!DOCTYPE html>\n<html>\n<head>\n<link rel="stylesheet" href="style.css">\n</head>\n<body>\n${editors.html.getValue()}\n<script src="script.js"><\/script>\n</body>\n</html>`;
    
    zip.file("index.html", html);
    zip.file("style.css", editors.css.getValue());
    zip.file("script.js", editors.js.getValue());
    
    zip.generateAsync({ type: "blob" }).then(content => {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(content);
        a.download = "mini-project.zip";
        a.click();
    });
}
</script>
</body>
</html>