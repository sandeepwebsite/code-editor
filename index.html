<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Code Editor Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>

    <style>
        :root { 
            --bg: #0f172a; 
            --panel: #020617; 
            --border: #1e293b; 
            --accent: #38bdf8; 
            --text: #e5e7eb;
            --icon-idle: #94a3b8; /* Fixed idle color */
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* HEADER */
        .header { height: 48px; display: flex; align-items: center; gap: 8px; padding: 0 12px; background: var(--panel); border-bottom: 1px solid var(--border); z-index: 20; }
        button.main-btn { background: #1e293b; border: 1px solid #334155; color: var(--text); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; }
        button.main-btn.active { background: #0ea5e9; border-color: #0ea5e9; color: white; }

        .mobile-nav { display: none; height: 44px; background: var(--panel); border-bottom: 1px solid var(--border); }
        .mobile-nav div { flex: 1; text-align: center; line-height: 44px; cursor: pointer; font-weight: 600; color: var(--icon-idle); }
        .mobile-nav .active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        .main { flex: 1; display: flex; overflow: hidden; }
        .editor-container { display: flex; width: 100%; height: 100%; }

        /* LEFT SIDE */
        .editor-left { width: 50%; display: flex; flex-direction: column; border-right: 1px solid var(--border); min-width: 0; }
        .tabs-container { display: flex; justify-content: space-between; align-items: center; background: var(--panel); border-bottom: 1px solid var(--border); }
        .tabs { display: flex; }
        .tab { padding: 12px 15px; cursor: pointer; font-size: 12px; color: var(--icon-idle); font-weight: 600; }
        .tab.active { color: white; background: #1e293b; box-shadow: inset 0 -2px 0 var(--accent); }

        /* TOOLBAR ICON COLORS */
        .editor-tools { display: flex; gap: 4px; padding-right: 8px; }
        .icon-btn { background: transparent; border: none; padding: 8px; cursor: pointer; color: var(--icon-idle); transition: color 0.2s, transform 0.1s; }
        .icon-btn:hover { color: var(--accent); }
        .icon-btn:active { transform: scale(0.9); }
        .icon-btn svg { width: 20px; height: 20px; fill: currentColor; }

        .editor-area { flex: 1; display: none; overflow: hidden; }
        .editor-area.active { display: block; }

        /* CONSOLE */
        .console { height: 140px; background: var(--panel); border-top: 1px solid var(--border); }
        .console-header { padding: 6px 12px; font-size: 11px; color: var(--icon-idle); display: flex; justify-content: space-between; }
        .console-body { height: 110px; overflow-y: auto; font-family: monospace; font-size: 12px; padding: 8px; color: #d1d5db; }

        /* DEVICE SIMULATOR ICON COLORS */
        .editor-right { flex: 1; background: #0f172a; display: flex; flex-direction: column; align-items: center; }
        .device-toolbar { width: 100%; height: 40px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: center; gap: 20px; }
        .dev-icon-btn { background: transparent; border: none; color: var(--icon-idle); cursor: pointer; padding: 8px; transition: 0.2s; }
        .dev-icon-btn svg { width: 22px; height: 22px; fill: currentColor; }
        .dev-icon-btn:hover { color: var(--text); }
        .dev-icon-btn.active { color: var(--accent); background: rgba(56, 189, 248, 0.1); border-radius: 4px; }

        #simulator-viewport { flex: 1; width: 100%; transition: width 0.3s ease; background: #fff; margin: 10px auto; border-radius: 4px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        iframe { width: 100%; height: 100%; border: none; }

        #paste-bridge { position: absolute; left: -9999px; top: 0; opacity: 0; }

        @media(max-width: 900px) {
            .mobile-nav { display: flex; }
            .editor-left, .editor-right { width: 100% !important; flex: none; }
            .mobile-hide { display: none !important; }
        }
    </style>
</head>
<body>

<textarea id="paste-bridge"></textarea>

<div class="header">
    <button class="main-btn" onclick="run()">Run â–¶</button>
    <button id="autoBtn" class="main-btn active" onclick="toggleAuto()">Auto Run: ON</button>
    <button class="main-btn" onclick="exportZIP()">Export ZIP</button>
</div>

<div class="mobile-nav">
    <div id="codeTab" class="active" onclick="showMobileView('code')">Code</div>
    <div id="previewTab" onclick="showMobileView('preview')">Preview</div>
</div>

<div class="main">
    <div class="editor-container">
        <div class="editor-left" id="codePane">
            <div class="tabs-container">
                <div class="tabs">
                    <div class="tab active" onclick="switchEditor('html', event)">HTML</div>
                    <div class="tab" onclick="switchEditor('css', event)">CSS</div>
                    <div class="tab" onclick="switchEditor('js', event)">JS</div>
                </div>
                <div class="editor-tools">
                    <button class="icon-btn" title="Select All" onclick="editorAction('selectAll')"><svg viewBox="0 0 24 24"><path d="M3 5h2V3c-1.1 0-2 .9-2 2zm0 8h2v-2H3v2zm4 8h2v-2H7v2zM3 9h2V7H3v2zm10-6h-2v2h2V3zm6 0v2h2c0-1.1-.9-2-2-2zM5 21v-2H3c0 1.1.9 2 2 2zm-2-4h2v-2H3v2zM9 3H7v2h2V3zm11 2h2V3h-2v2zm0 12h2v-2h-2v2zm-4 4h2v-2h-2v2z"/></svg></button>
                    <button class="icon-btn" title="Copy" onclick="editorAction('copy')"><svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button>
                    <button class="icon-btn" title="Paste" onclick="fastPaste()"><svg viewBox="0 0 24 24"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg></button>
                </div>
            </div>
            <div id="html" class="editor-area active"></div>
            <div id="css" class="editor-area"></div>
            <div id="js" class="editor-area"></div>
            <div class="console">
                <div class="console-header"><span>CONSOLE</span><span style="cursor:pointer;color:var(--accent)" onclick="document.getElementById('console').innerHTML=''">CLEAR</span></div>
                <div class="console-body" id="console"></div>
            </div>
        </div>
        <div class="editor-right mobile-hide" id="previewPane">
            <div class="device-toolbar">
                <button class="dev-icon-btn active" onclick="setDevice('100%', this)"><svg viewBox="0 0 24 24"><path d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7l-2 3v1h8v-1l-2-3h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 12H3V4h18v10z"/></svg></button>
                <button class="dev-icon-btn" onclick="setDevice('768px', this)"><svg viewBox="0 0 24 24"><path d="M18.5 0h-13C3.57 0 2 1.57 2 3.5v17C2 22.43 3.57 24 5.5 24h13c1.93 0 3.5-1.57 3.5-3.5v-17C22 1.57 20.43 0 18.5 0zm-6.5 22c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm7.5-4H4V3h15v15z"/></svg></button>
                <button class="dev-icon-btn" onclick="setDevice('375px', this)"><svg viewBox="0 0 24 24"><path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/></svg></button>
            </div>
            <div id="simulator-viewport"><iframe id="preview"></iframe></div>
        </div>
    </div>
</div>

<script>
let editors = {}, autoRun = true, activeTab = 'html';

require.config({ paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs" }});
require(["vs/editor/editor.main"], function () {
    const cfg = { theme: "vs-dark", automaticLayout: true, fontSize: 14, minimap: { enabled: false }, formatOnPaste: false, autoIndent: "none", scrollBeyondLastLine: false, wordWrap: "on" };
    editors.html = monaco.editor.create(document.getElementById("html"), { value: "<h1>Colors Fixed</h1>", language: "html", ...cfg });
    editors.css = monaco.editor.create(document.getElementById("css"), { value: "body { padding: 20px; color: #334155; }", language: "css", ...cfg });
    editors.js = monaco.editor.create(document.getElementById("js"), { value: "console.log('UI updated');", language: "javascript", ...cfg });
    Object.values(editors).forEach(e => e.onDidChangeModelContent(() => autoRun && run()));
    run();
});

async function fastPaste() {
    const ed = editors[activeTab]; ed.focus();
    try {
        const text = await navigator.clipboard.readText();
        ed.executeEdits("", [{ range: ed.getSelection(), text: text, forceMoveMarkers: true }]);
    } catch (err) {
        const bridge = document.getElementById('paste-bridge');
        bridge.value = ''; bridge.focus();
        setTimeout(() => {
            if(bridge.value) {
                ed.executeEdits("", [{ range: ed.getSelection(), text: bridge.value, forceMoveMarkers: true }]);
                ed.focus();
            }
        }, 50);
    }
}

function editorAction(act) {
    const ed = editors[activeTab]; ed.focus();
    if (act === 'selectAll') ed.setSelection(ed.getModel().getFullModelRange());
    else if (act === 'copy') {
        const txt = ed.getModel().getValueInRange(ed.getSelection()) || ed.getValue();
        navigator.clipboard.writeText(txt);
    }
}

function run() {
    const source = `<!DOCTYPE html><html><head><style>${editors.css.getValue()}</style></head><body>${editors.html.getValue()}<script>(function(){const send=(type,args)=>window.parent.postMessage({type,msg:args.map(a=>typeof a==='object'?JSON.stringify(a):a).join(' ')},"*");console.log=(...args)=>send('log',args);})();try{${editors.js.getValue()}}catch(e){console.error(e.message);}<\/script></body></html>`;
    document.getElementById("preview").srcdoc = source;
}

window.addEventListener("message", e => {
    if(!e.data.type) return;
    const div = document.createElement("div");
    div.textContent = "> " + e.data.msg;
    document.getElementById("console").appendChild(div);
    document.getElementById("console").scrollTop = document.getElementById("console").scrollHeight;
});

function switchEditor(mode, e) {
    activeTab = mode;
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".editor-area").forEach(a => a.classList.remove("active"));
    e.target.classList.add("active");
    document.getElementById(mode).classList.add("active");
    editors[mode].layout();
}

function showMobileView(view) {
    const code = document.getElementById("codePane"), preview = document.getElementById("previewPane");
    if(view === 'code') {
        code.classList.remove("mobile-hide"); preview.classList.add("mobile-hide");
        document.getElementById("codeTab").classList.add("active"); document.getElementById("previewTab").classList.remove("active");
        setTimeout(() => Object.values(editors).forEach(e => e.layout()), 50);
    } else {
        code.classList.add("mobile-hide"); preview.classList.remove("mobile-hide");
        document.getElementById("previewTab").classList.add("active"); document.getElementById("codeTab").classList.remove("active");
        run();
    }
}

function setDevice(width, btn) {
    document.getElementById("simulator-viewport").style.width = width;
    document.querySelectorAll('.dev-icon-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function toggleAuto() {
    autoRun = !autoRun;
    document.getElementById("autoBtn").textContent = "Auto Run: " + (autoRun ? "ON" : "OFF");
    document.getElementById("autoBtn").classList.toggle("active", autoRun);
}

function exportZIP() {
    const zip = new JSZip();
    zip.file("index.html", editors.html.getValue());
    zip.file("style.css", editors.css.getValue());
    zip.file("script.js", editors.js.getValue());
    zip.generateAsync({type:"blob"}).then(c => {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(c); a.download = "project.zip"; a.click();
    });
}
</script>
</body>
</html>
